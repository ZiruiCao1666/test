// app/(home)/_layout.jsx
import React from 'react';
import { Stack, Redirect } from 'expo-router';
import { useAuth } from '@clerk/clerk-expo';
import { View, Text, ActivityIndicator } from "react-native";
import FontAwesome from '@expo/vector-icons/FontAwesome';


export default function HomeLayout() {
  const { isSignedIn, isLoaded } = useAuth();

  if (!isLoaded) {
    return (
      <View style={{ flex: 1, alignItems: "center", justifyContent: "center" }}>
        <ActivityIndicator />
        <Text style={{ marginTop: 8 }}>Loading...</Text>
      </View>
    );
  }


  //export default function HomeLayout() { return <Stack screenOptions={{ headerShown: false }} />; }

  // 未登录，访问 (home) 这组页面时转到 /sign-in 在嵌套 layout 里做 redirect guard 
  // https://docs.expo.dev/router/advanced/authentication/
  if (!isSignedIn) {
    return <Redirect href="/sign-in" />;
  }

  //return <Stack screenOptions={{ headerShown: false }} />;

  // 已登录，正常渲染 (home) 里的页面 
  // https://docs.expo.dev/router/advanced/stack/

//(home)/_layout 和 (auth)/_layout 分流形成闭环，未登录只能在auth组，已登录只能在home组，用路由组做权限分区


 // 3) Expo Router 官方 Tabs：用 <Tabs> 固定底部栏 :contentReference[oaicite:14]{index=14}
  return (
    <Tabs
      screenOptions={{
        headerShown: false,
        // 固定底部栏样式：高度/内边距（你截图那种更“贴底”）
        tabBarStyle: {
          height: 62,
          paddingTop: 6,
          paddingBottom: 10,
        },
        tabBarLabelStyle: {
          fontSize: 12,
        },
      }}
    >
      {/* 4个入口分别对应 4个文件：
          index.jsx / calendar.jsx / rewards.jsx / my-profile.jsx
          这就是 Expo Router 的“文件即路由”机制 :contentReference[oaicite:15]{index=15}
      */}

      <Tabs.Screen
        name="index"
        options={{
          // 你的图里 home 只有图标没有文字
          tabBarLabel: '',
          tabBarIcon: ({ color, size, focused }) => (
            <FontAwesome name={focused ? 'home' : 'home'} size={size ?? 24} color={color} />
          ),
        }}
      />

      <Tabs.Screen
        name="calendar"
        options={{
          title: 'calendar',
        }}
      />

      <Tabs.Screen
        name="rewards"
        options={{
          title: 'rewards',
        }}
      />

      <Tabs.Screen
        name="my-profile"
        options={{
          title: 'my profile',
        }}
      />
    </Tabs>
  );
  }